---
name: commit
description: Create a git commit with AI identification via Git trailers (no visible signature in message)
argument-hint: "[message]"
---

Create a git commit following repository conventions with AI identification through Git trailers instead of visible signatures in the commit message body.

## ‚õî HARD STOP - READ THIS FIRST ‚õî

**BEFORE writing ANY git commit command, answer this checkpoint:**

- [ ] Will my `-m` parameters contain ONLY the commit message (subject + optional body)?
- [ ] Will ALL AI attribution use `--trailer` parameters OUTSIDE of `-m`?
- [ ] Is my message body FREE of emojis, signatures, and "Generated by" text?

**If you answered NO to ANY question ‚Üí STOP. Re-read the MANDATORY RULES below.**

## Required Command Structure

**EVERY git commit command you create MUST follow this exact structure:**

```bash
git commit \
  -m "commit message line 1" \
  -m "optional body line 2" \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: <model-id>"
```

**Notice:**
- `-m` parameters come FIRST
- `-m` contains ONLY the commit message (no trailers, no signatures)
- `--trailer` parameters come AFTER all `-m` parameters
- `--trailer` is a SEPARATE command-line argument

**If your command doesn't match this structure ‚Üí YOU ARE DOING IT WRONG.**

## MANDATORY RULES (NON-NEGOTIABLE)

**These rules MUST be followed for EVERY commit:**

1. **NEVER include visible AI signatures in commit message body:**
   - NO `ü§ñ Generated with [Claude Code](https://claude.com/claude-code)`
   - NO `Co-Authored-By: Claude <noreply@anthropic.com>`
   - NO emoji signatures of any kind
   - NO "Generated by AI" text in message body
   - **The `-m` parameter contains ONLY the commit message. PERIOD.**

2. **ALWAYS use `--trailer` parameter for AI identification:**
   - `--trailer "Generated-by: Claude"` - REQUIRED
   - `--trailer "AI-Model: <model-id>"` - REQUIRED
   - Trailers go AFTER all `-m` parameters in the git command
   - Trailers are SEPARATE command-line arguments, NOT part of message text

3. **Commit message body must be clean and professional:**
   - Only the actual commit description
   - No metadata, signatures, or AI attribution in the body
   - If you see emoji or "Generated" in your `-m` text ‚Üí YOU ARE DOING IT WRONG

## Commit Process

### Step 1: Gather Context

Run these commands in parallel to understand the current state:

```bash
# Check staged and unstaged changes
git status

# View staged changes
git diff --cached

# View recent commits for style reference
git log --oneline -10
```

### Step 2: Analyze Changes

Based on the diff output:
1. **Identify the type of change**: feat, fix, chore, docs, refactor, test, style, perf, ci, build
2. **Determine the scope** (optional): component or area affected
3. **Summarize the "why"**: Focus on purpose, not just what changed

### Step 3: Draft Commit Message

Follow the repository's existing commit style. If Conventional Commits is used:

```
<type>(<scope>): <subject>

<body - optional>
```

**Guidelines:**
- Subject line: max 50 characters, imperative mood ("add" not "added")
- Body: wrap at 72 characters, explain motivation/context
- **DO NOT include** emoji signatures, "Generated by AI", or Co-Authored-By in the message body

### Step 4: Create Commit with Trailers

Use Git's `--trailer` parameter for AI identification. This keeps trailers separate from the message and follows Git's native trailer handling:

```bash
git commit \
  -m "<type>(<scope>): <subject>" \
  -m "<body if needed>" \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: claude-opus-4-5-20251101"
```

**Available Trailers:**
- `--trailer "Generated-by: Claude"` - Identifies AI assistance
- `--trailer "AI-Model: <model-id>"` - Specific model used
- `--trailer "AI-Session: <id>"` - Session identifier (optional)
- `--trailer "Reviewed-by: <name>"` - If human reviewed before commit

### Step 5: Verify Commit

After committing, verify with:

```bash
git log -1 --format=full
git status
```

## Examples

### Simple Feature
```bash
git commit \
  -m "feat(auth): add OAuth2 refresh token support" \
  -m "Implements automatic token refresh when access token expires, preventing session interruptions for long-running operations." \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: claude-opus-4-5-20251101"
```

### Bug Fix
```bash
git commit \
  -m "fix(api): handle null response in user endpoint" \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: claude-opus-4-5-20251101"
```

### Chore/Refactor
```bash
git commit \
  -m "chore: update dependencies to latest versions" \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: claude-opus-4-5-20251101"
```

## Trailer Query Commands

Trailers can be queried programmatically:

```bash
# Find all AI-generated commits
git log --all --grep="Generated-by: Claude"

# Show trailers for a commit
git log -1 --format="%(trailers)"

# Filter by specific trailer
git log --all --format="%H %s" | while read hash msg; do
  git log -1 --format="%(trailers:key=Generated-by)" $hash | grep -q Claude && echo "$hash $msg"
done
```

## Important Notes

1. **No visible AI signature** - The message body stays clean and professional
2. **Trailers are standard** - Git trailers are a recognized convention (like Signed-off-by)
3. **Machine-readable** - Easy to filter/query AI-generated commits
4. **Transparent** - AI assistance is documented, just not prominently displayed
5. **Do not use --no-verify** - Always run pre-commit hooks unless user explicitly requests

## Anti-Patterns (NEVER DO THIS)

**‚õî THESE PATTERNS ARE FORBIDDEN. DO NOT USE THEM. ‚õî**

```bash
# ‚ùå WRONG - emoji signature in message body
git commit -m "feat: add feature

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)"

# ‚ùå WRONG - Co-Authored-By in message body
git commit -m "feat: add feature

Co-Authored-By: Claude <noreply@anthropic.com>"

# ‚ùå WRONG - HEREDOC with signature in message body
git commit -m "$(cat <<'EOF'
feat: add feature

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
EOF
)"

# ‚ùå WRONG - Trailer text inside -m parameter
git commit -m "feat: add feature

Generated-by: Claude
AI-Model: claude-sonnet-4-5-20250929"

# ‚ùå WRONG - ANY attempt to include trailers in message body
# The message body (-m parameter) must ONLY contain the commit description
# NO trailers, NO signatures, NO emoji, NO attribution of any kind
```

**Why these are wrong:** They put AI attribution in the commit message body, making it visible in `git log --oneline` and polluting the commit history.

```bash
# ‚úÖ CORRECT - clean message with trailers via --trailer parameter
git commit \
  -m "feat: add feature" \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: claude-opus-4-5-20251101"
```

**Why this is correct:** Trailers are separate from the message body and only visible in `git log --format=full` or `git log --format="%(trailers)"`. The commit message stays clean.

## When User Provides Message

If the user provides a commit message as argument:
1. Use their message as the subject/body
2. Ensure proper formatting (50 char subject, etc.)
3. Append the trailers via `--trailer` parameter

```bash
# User says: /ring-default:commit "fix login bug"
git commit \
  -m "fix: fix login bug" \
  --trailer "Generated-by: Claude" \
  --trailer "AI-Model: claude-opus-4-5-20251101"
```

## Step 6: Offer Push (Optional)

After successful commit, ask the user if they want to push:

```javascript
AskUserQuestion({
  questions: [{
    question: "Push commit to remote?",
    header: "Push",
    multiSelect: false,
    options: [
      { label: "Yes", description: "Push to current branch" },
      { label: "No", description: "Keep local only" }
    ]
  }]
});
```

If user selects "Yes":
```bash
git push
```

If branch has no upstream, use:
```bash
git push -u origin <current-branch>
```
